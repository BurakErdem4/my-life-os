<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Life OS</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- üî• BURAYI MOBƒ∞L UYGULAMADAKƒ∞ AYNISIYLA DOLDUR ---
         const firebaseConfig = {
      apiKey: "AIzaSyB_zE9V8BtMtDjCyeT2FW8IqTe7CN4cSL8",
      authDomain: "lifeos-app-82013.firebaseapp.com",
      projectId: "lifeos-app-82013",
      storageBucket: "lifeos-app-82013.firebasestorage.app",
      messagingSenderId: "890704581310",
      appId: "1:890704581310:web:f9aa83314a207eda6904ef",
    };

        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.doc = doc;
            window.onSnapshot = onSnapshot;
            window.setDoc = setDoc;
        } catch(e) { console.error(e); }
    </script>

    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #e5e7eb; margin: 0; padding: 0; height: 100dvh; display: flex; justify-content: center; overflow: hidden; }
        #root { width: 100%; max-width: 28rem; height: 100%; background-color: white; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const USER_DOC_ID = "my_life_os_data_v6"; 

        // Varsayƒ±lanlar
        const DEFAULT_HABITS = [{ id: 'h1', title: 'Yataƒüƒ± Topla', icon: 'üõèÔ∏è' }, { id: 'h2', title: 'Kitap Oku', icon: 'üìñ' }];
        const DEFAULT_REWARDS = [{ id: 1, title: "Kahve", cost: 20, icon: "‚òï" }];

        // --- SVG HALKA ---
        const HabitRing = ({ total, completed, size = 46 }) => {
            if (!total || total === 0) return null;
            const center = size / 2;
            const radius = (size - 5) / 2;
            const gap = total > 1 ? 12 : 0; 
            const segmentAngle = 360 / total;
            
            const describeArc = (x, y, radius, startAngle, endAngle) => {
                const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {
                    var angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
                    return { x: centerX + (radius * Math.cos(angleInRadians)), y: centerY + (radius * Math.sin(angleInRadians)) };
                }
                var start = polarToCartesian(x, y, radius, endAngle);
                var end = polarToCartesian(x, y, radius, startAngle);
                var largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                return ["M", start.x, start.y, "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y].join(" ");
            }

            return (
                <svg width={size} height={size} style={{position:'absolute', pointerEvents:'none', left:0, top:0}}>
                    {Array.from({ length: total }).map((_, i) => {
                        const start = i * segmentAngle + (gap/2);
                        const end = (i + 1) * segmentAngle - (gap/2);
                        const isCompleted = i < completed;
                        const color = isCompleted ? "#EAB308" : "rgba(200, 200, 200, 0.2)"; 
                        const strokeWidth = isCompleted ? 2.5 : 2;
                        const effectiveEnd = total === 1 ? start + 359.9 : end;
                        return <path key={i} d={describeArc(center, center, radius, start, effectiveEnd)} stroke={color} strokeWidth={strokeWidth} fill="none" strokeLinecap="round" />
                    })}
                </svg>
            )
        }

        // --- ICON Bƒ∞LE≈ûENƒ∞ ---
        const Icon = ({ name, size=20, className="", color="currentColor" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={name} width={size} height={size} className={className} style={{color}}></i>;
        };

        function App() {
            const [data, setData] = useState(null);
            const [activeTab, setActiveTab] = useState('planner');
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [modal, setModal] = useState({ open: false, type: null, data: null });
            const [form, setForm] = useState({});
            const [flippedCards, setFlippedCards] = useState({}); 

            // --- FIREBASE SYNC ---
            useEffect(() => {
                const checkDB = setInterval(() => {
                    if (window.db) {
                        clearInterval(checkDB);
                        window.onSnapshot(window.doc(window.db, "lifeos_data", USER_DOC_ID), (doc) => {
                            if (doc.exists()) {
                                setData(doc.data());
                            } else {
                                const initData = { projects: [], history: {}, habits: DEFAULT_HABITS, rewards: DEFAULT_REWARDS, gold: 0 };
                                window.setDoc(window.doc(window.db, "lifeos_data", USER_DOC_ID), initData);
                                setData(initData);
                            }
                        });
                    }
                }, 100);
            }, []);

            useEffect(() => { if(data) lucide.createIcons(); }, [data, activeTab, modal, selectedDate]);

            if (!data) return <div className="h-full w-full flex flex-col items-center justify-center text-indigo-600 font-bold animate-pulse"><Icon name="loader-2" className="animate-spin mb-2"/> Y√ºkleniyor...</div>;

            // --- YARDIMCILAR ---
            const getDateKey = (d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };
            const dateKey = getDateKey(selectedDate);
            const todayKey = getDateKey(new Date());
            const currentDayData = data.history[dateKey] || { tasks: [], habits: [], journal: null };

            const saveToFirebase = (newData) => {
                setData(newData);
                window.setDoc(window.doc(window.db, "lifeos_data", USER_DOC_ID), newData);
            };
            const updateGold = (amount) => saveToFirebase({...data, gold: data.gold + amount});

            // --- PUANLAMA VE MESAJLAR ---
            const getDailyStatus = (dayTasks) => {
                 if (!dayTasks || dayTasks.length === 0) return { score: 0, text: "Plan yok", color: "bg-gray-100 text-gray-400 border-gray-200" };
                 let doneCount = 0;
                 dayTasks.forEach(t => {
                    if(t.subItems) doneCount += (t.subItems.filter(Boolean).length / t.subItems.length);
                    else if(t.completed) doneCount += 1;
                 });
                 const p = (doneCount / dayTasks.length) * 100;
                 if(p === 0) return { text: "Ba≈ülangƒ±√ß...", color: "bg-red-50 text-red-500 border-red-100" };
                 if(p < 40) return { text: "Daha iyi olabilirsin", color: "bg-orange-50 text-orange-500 border-orange-100" };
                 if(p < 70) return { text: "Geli≈üiyorsun", color: "bg-yellow-50 text-yellow-600 border-yellow-100" };
                 if(p < 95) return { text: "√áok iyisin", color: "bg-green-50 text-green-600 border-green-100" };
                 return { text: "Harika bir g√ºn!", color: "bg-cyan-50 text-cyan-600 border-cyan-100" };
            };
            const dailyStatus = getDailyStatus(currentDayData.tasks);

            // --- ƒ∞≈ûLEMLER (Ekleme/Silme/G√ºncelleme) ---
            const toggleHabit = (id) => {
                const isDone = (currentDayData.habits || []).includes(id);
                let newHabits = isDone ? currentDayData.habits.filter(h => h !== id) : [...(currentDayData.habits||[]), id];
                let goldChange = 0;
                if (dateKey === todayKey) goldChange = isDone ? -10 : 10;
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, habits: newHabits } };
                saveToFirebase({ ...data, history: newHistory, gold: data.gold + goldChange });
            };

            const addTask = () => {
                const newTask = modal.type === 'simple' 
                    ? { id: Date.now(), title: form.title, type: 'simple', completed: false, duration: form.time || '30', startTime: form.startTime || '' }
                    : { id: Date.now(), title: `${modal.data.title} (${form.amount} ${modal.data.unit})`, type: 'project_slice', pid: modal.data.id, subItems: new Array(Number(form.amount)).fill(false), completed: false, duration: form.time || '60', startTime: form.startTime || '' };
                
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, tasks: [...(currentDayData.tasks||[]), newTask] } };
                saveToFirebase({ ...data, history: newHistory });
                setModal({open: false});
            };

            const toggleTask = (id) => {
                const task = currentDayData.tasks.find(t => t.id === id);
                const newStatus = !task.completed;
                const updatedTasks = currentDayData.tasks.map(t => t.id === id ? {...t, completed: newStatus} : t);
                let goldChange = 0;
                if (dateKey === todayKey) goldChange = newStatus ? 10 : -10;
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, tasks: updatedTasks } };
                saveToFirebase({ ...data, history: newHistory, gold: data.gold + goldChange });
            };

            const toggleSubItem = (taskId, idx) => {
                let goldChange = 0;
                let projectsUpdate = [...data.projects];
                const updatedTasks = currentDayData.tasks.map(t => {
                    if (t.id === taskId) {
                        const newSub = [...t.subItems];
                        const wasDone = newSub[idx];
                        newSub[idx] = !wasDone;
                        if (t.type === 'project_slice') {
                            projectsUpdate = projectsUpdate.map(p => {
                                if (p.id === t.pid) {
                                    const change = wasDone ? -1 : 1;
                                    return { ...p, currentUnit: Math.max(0, (p.currentUnit||0) + change) };
                                }
                                return p;
                            });
                            if (dateKey === todayKey) goldChange = wasDone ? -10 : 10;
                        }
                        const allDone = newSub.every(Boolean);
                        return { ...t, subItems: newSub, completed: allDone };
                    }
                    return t;
                });
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, tasks: updatedTasks } };
                saveToFirebase({ ...data, history: newHistory, projects: projectsUpdate, gold: data.gold + goldChange });
            };

            const deleteTask = (id) => {
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, tasks: currentDayData.tasks.filter(t => t.id !== id) } };
                saveToFirebase({ ...data, history: newHistory });
            };

            const saveProject = () => {
                const pData = {
                    id: form.id || Date.now(), title: form.title, totalUnit: Number(form.total),
                    currentUnit: Number(form.current) || 0, unit: form.unit, totalEstTime: Number(form.estTime), notes: form.notes || ''
                };
                let newProjs = form.id ? data.projects.map(p => p.id === form.id ? {...p, ...pData} : p) : [...data.projects, pData];
                saveToFirebase({...data, projects: newProjs});
                setModal({open:false});
            };

            const updateProjectNotes = (pid, text) => {
                const newProjs = data.projects.map(p => p.id === pid ? {...p, notes: text} : p);
                saveToFirebase({...data, projects: newProjs});
            };

            const deleteProject = (pid) => {
                if(confirm("Projeyi silmek istiyor musun?")) {
                     saveToFirebase({...data, projects: data.projects.filter(p => p.id !== pid)});
                }
            };

            const addHabit = () => {
                saveToFirebase({...data, habits: [...data.habits, {id: Date.now(), title: form.title, icon: form.icon}]});
                setForm({...form, title:'', icon:''});
            };
            const deleteHabit = (id) => saveToFirebase({...data, habits: data.habits.filter(h => h.id !== id)});
            
            const addReward = () => {
                saveToFirebase({...data, rewards: [...data.rewards, {id: Date.now(), title: form.title, cost: Number(form.cost), icon: form.icon}]});
                setModal({open:false});
            };
            const deleteReward = (id) => saveToFirebase({...data, rewards: data.rewards.filter(r => r.id !== id)});
            const buyReward = (r) => {
                if(data.gold >= r.cost && confirm(`${r.title} almak istiyor musun?`)) updateGold(-r.cost);
                else if(data.gold < r.cost) alert("Para yok!");
            };

            const saveJournal = () => {
                const newHistory = { ...data.history, [dateKey]: { ...currentDayData, journal: { mood: form.mood, note: form.note } } };
                saveToFirebase({ ...data, history: newHistory });
                setModal({open:false});
            };

            const openModal = (type, d=null) => {
                setModal({ open: true, type, data: d });
                setForm({});
                if (type === 'project_form' && d) { 
                    setForm({ id: d.id, title: d.title, total: d.totalUnit, unit: d.unit, estTime: d.totalEstTime, current: d.currentUnit, notes: d.notes });
                }
                if (type === 'journal') {
                    setForm({ mood: currentDayData.journal?.mood, note: currentDayData.journal?.note });
                }
            };

            // --- RENDER ---
            return (
                <div className="w-full h-full flex flex-col bg-white relative">
                    
                    {/* HEADER */}
                    <div className="p-5 bg-white border-b flex justify-between items-center z-20 shrink-0">
                        <div>
                            <div className="text-[10px] font-bold text-gray-400 uppercase">DURUM</div>
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => openModal('journal')}>
                                <div className={`px-2 py-1 rounded text-xs font-bold border ${dailyStatus.color}`}>{dailyStatus.text}</div>
                                <span className="animate-pulse text-green-500 text-xs">‚óè</span>
                            </div>
                        </div>
                        <div className="bg-yellow-50 px-3 py-1 rounded-full border border-yellow-100 flex items-center gap-1 text-yellow-600 font-bold">
                            {data.gold} <Icon name="coins" size={16} />
                        </div>
                    </div>

                    {/* DATE NAV (Planner only) */}
                    {activeTab === 'planner' && (
                        <div className="flex items-center justify-between p-4 bg-gray-50 border-b border-gray-100 shrink-0">
                             <button onClick={() => setSelectedDate(new Date(selectedDate.setDate(selectedDate.getDate() - 1)))}><Icon name="chevron-left" /></button>
                             <span className="font-bold text-gray-700 flex items-center gap-2">
                                 {selectedDate.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' })}
                                 {dateKey === todayKey && <span className="w-2 h-2 rounded-full bg-indigo-500"></span>}
                             </span>
                             <button onClick={() => setSelectedDate(new Date(selectedDate.setDate(selectedDate.getDate() + 1)))}><Icon name="chevron-right" /></button>
                        </div>
                    )}

                    {/* CONTENT AREA */}
                    <div className="flex-1 overflow-y-auto p-5 bg-gray-50/30 space-y-6 no-scrollbar pb-24">
                        
                        {/* --- PLANNER --- */}
                        {activeTab === 'planner' && (
                            <>
                                <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 overflow-x-auto whitespace-nowrap no-scrollbar flex gap-4">
                                    {data.habits.map(h => {
                                        const isDone = (currentDayData.habits||[]).includes(h.id);
                                        return (
                                            <div key={h.id} onClick={() => toggleHabit(h.id)} className="inline-flex flex-col items-center cursor-pointer group min-w-[60px]">
                                                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl border-2 transition-all ${isDone ? 'bg-indigo-100 border-indigo-500 scale-110' : 'bg-gray-50 border-gray-200 grayscale group-hover:grayscale-0'}`}>{h.icon}</div>
                                                <span className={`text-[10px] mt-2 font-bold ${isDone ? 'text-indigo-600':'text-gray-400'}`}>{h.title}</span>
                                            </div>
                                        )
                                    })}
                                </div>

                                <div className="space-y-3">
                                    {(currentDayData.tasks||[]).map(t => (
                                        <div key={t.id} className={`bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-start gap-3 transition-all ${t.completed ? 'opacity-60':''}`}>
                                            {t.type === 'simple' ? 
                                                <button onClick={() => toggleTask(t.id)} className={`mt-1 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${t.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 hover:border-indigo-500'}`}>{t.completed && <Icon name="check" size={14} />}</button>
                                                : <div className="mt-1 w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center text-[10px] font-bold text-indigo-600">{t.subItems.filter(Boolean).length}</div>
                                            }
                                            <div className="flex-1">
                                                <div className={`font-bold text-gray-800 ${t.completed ? 'line-through text-gray-400':''}`}>{t.title}</div>
                                                <div className="flex items-center gap-3 text-xs text-gray-400 mt-1">
                                                    <span className="flex items-center gap-1"><Icon name="clock" size={12}/> {t.duration}dk</span>
                                                    {t.startTime && <span className="bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded">{t.startTime}</span>}
                                                </div>
                                                {t.subItems && (
                                                    <div className="flex gap-1 mt-2 flex-wrap">
                                                        {t.subItems.map((done, i) => (
                                                            <button key={i} onClick={() => toggleSubItem(t.id, i)} className={`w-6 h-6 rounded border flex items-center justify-center text-[10px] ${done ? 'bg-green-500 text-white border-green-500':'bg-white text-gray-400 hover:border-indigo-400'}`}>{done ? '‚úì' : i+1}</button>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                            <button onClick={() => deleteTask(t.id)} className="text-gray-300 hover:text-red-500"><Icon name="trash-2" size={16} /></button>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => {setForm({}); setModal({type:'selection'});}} className="w-full py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-400 font-bold hover:text-indigo-600 hover:border-indigo-300 flex items-center justify-center gap-2"><Icon name="plus"/> G√∂rev Ekle</button>
                            </>
                        )}

                        {/* --- PROJECTS --- */}
                        {activeTab === 'projects' && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center"><h2 className="font-bold text-gray-700">B√ºy√ºk Hedefler</h2><button onClick={() => {setForm({}); setModal({type:'project_form'});}} className="text-xs bg-indigo-50 text-indigo-600 px-3 py-1 rounded font-bold">+ YENƒ∞</button></div>
                                {data.projects.map(p => {
                                    const pct = Math.round(((p.currentUnit||0) / p.totalUnit) * 100);
                                    const isFlipped = flippedCards[p.id];
                                    return (
                                        <div key={p.id} className="relative h-64 perspective-1000 group w-full">
                                            <div className={`w-full h-full relative transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                                                {/* Front */}
                                                <div className="absolute inset-0 bg-white p-5 rounded-xl shadow-sm border border-gray-100 backface-hidden flex flex-col justify-between">
                                                    <div>
                                                        <div className="flex justify-between items-start">
                                                            <h3 className="font-bold text-lg">{p.title}</h3>
                                                            <div className="flex gap-2">
                                                                <button onClick={() => openModal('project_form', p)}><Icon name="edit-2" className="w-4 h-4 text-gray-400 hover:text-indigo-600"/></button>
                                                                <button onClick={() => setFlippedCards({...flippedCards, [p.id]: true})}><Icon name="refresh-cw" className="w-4 h-4 text-gray-400 hover:text-indigo-600"/></button>
                                                            </div>
                                                        </div>
                                                        <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500 mt-2 inline-block">{p.currentUnit}/{p.totalUnit} {p.unit}</span>
                                                    </div>
                                                    <div>
                                                        <div className="flex justify-between text-xs font-bold text-indigo-600 mb-1"><span>ƒ∞LERLEME</span><span>%{pct}</span></div>
                                                        <div className="h-2 bg-gray-100 rounded-full overflow-hidden"><div className="h-full bg-indigo-600 transition-all duration-500" style={{width: `${pct}%`}}></div></div>
                                                    </div>
                                                </div>
                                                {/* Back */}
                                                <div className="absolute inset-0 bg-gray-800 text-white p-5 rounded-xl shadow-lg rotate-y-180 backface-hidden flex flex-col">
                                                    <div className="flex justify-between border-b border-gray-700 pb-2 mb-2">
                                                        <span className="text-xs font-bold tracking-widest text-gray-400">KASA</span>
                                                        <button onClick={() => setFlippedCards({...flippedCards, [p.id]: false})}><Icon name="refresh-cw" className="w-4 h-4"/></button>
                                                    </div>
                                                    <textarea className="flex-1 bg-gray-700 rounded p-2 text-sm text-gray-200 resize-none mb-2 outline-none" placeholder="Notlar..." value={p.notes||''} onChange={(e) => updateProjectNotes(p.id, e.target.value)}></textarea>
                                                    <button onClick={() => deleteProject(p.id)} className="text-xs text-red-400 text-right hover:text-red-300">Projeyi Sil</button>
                                                </div>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        )}

                        {/* --- HABITS EDIT --- */}
                        {activeTab === 'habits' && (
                            <div className="space-y-4">
                                <h2 className="font-bold text-gray-700">Rutin D√ºzenleyici</h2>
                                {data.habits.map(h => (
                                    <div key={h.id} className="flex justify-between items-center p-3 bg-white rounded-xl border hover:shadow-sm">
                                        <div className="flex items-center gap-3"><span className="text-2xl">{h.icon}</span><span className="font-bold">{h.title}</span></div>
                                        <button onClick={() => deleteHabit(h.id)} className="text-red-400"><Icon name="trash-2" /></button>
                                    </div>
                                ))}
                                <div className="pt-4 border-t mt-4">
                                    <div className="flex gap-2">
                                        <input className="w-16 p-2 border rounded-xl text-center" placeholder="üßò" value={form.icon||''} onChange={e=>setForm({...form, icon:e.target.value})} />
                                        <input className="flex-1 p-2 border rounded-xl" placeholder="Rutin Adƒ±" value={form.title||''} onChange={e=>setForm({...form, title:e.target.value})} />
                                    </div>
                                    <button onClick={addHabit} className="w-full bg-indigo-600 text-white py-2 rounded mt-2 font-bold shadow-lg hover:bg-indigo-700 transition">Ekle</button>
                                </div>
                            </div>
                        )}

                        {/* --- STORE --- */}
                        {activeTab === 'store' && (
                            <div className="space-y-6">
                                <div className="bg-yellow-400 p-6 rounded-2xl text-white shadow-lg flex items-center justify-between">
                                    <div><div className="opacity-80 text-sm font-bold">BAKƒ∞YE</div><div className="text-4xl font-bold">{data.gold}</div></div>
                                    <Icon name="coins" size={48} className="opacity-50" />
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {data.rewards.map(r => (
                                        <div key={r.id} onClick={() => buyReward(r)} className="bg-white p-4 rounded-xl border hover:shadow-md cursor-pointer relative group text-center">
                                            <button onClick={(e) => {e.stopPropagation(); deleteReward(r.id);}} className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600"><Icon name="trash-2" size={16}/></button>
                                            <div className="text-3xl mb-2">{r.icon}</div>
                                            <div className="font-bold text-sm leading-tight">{r.title}</div>
                                            <div className="text-xs font-bold text-yellow-600 mt-1">{r.cost} Altƒ±n</div>
                                        </div>
                                    ))}
                                    <button onClick={() => {setForm({}); setModal({type:'reward_new'})}} className="border-2 border-dashed rounded-xl flex flex-col items-center justify-center text-gray-400 min-h-[100px] hover:border-indigo-400 hover:text-indigo-600"><Icon name="plus"/><span className="text-xs font-bold mt-1">√ñd√ºl Ekle</span></button>
                                </div>
                            </div>
                        )}

                        {/* --- CALENDAR --- */}
                        {activeTab === 'calendar' && (
                            <div className="space-y-6">
                                <div className="bg-white p-4 rounded-xl shadow-sm border">
                                    <h3 className="text-center font-bold mb-4">{selectedDate.toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' })}</h3>
                                    <div className="grid grid-cols-7 gap-2 relative">
                                        {Array.from({ length: new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0).getDate() }, (_, i) => {
                                            const d = i + 1;
                                            const dDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), d);
                                            const k = getDateKey(dDate);
                                            const dayStat = data.history[k];
                                            const completedHabits = dayStat?.habits?.length || 0;
                                            const totalHabits = data.habits.length || 1;
                                            const score = dayStat ? (dayStat.tasks && dayStat.tasks.length > 0 ? getDailyStatus(dayStat.tasks).score : 0) : 0;
                                            const isSelected = k === dateKey;
                                            let bg = 'bg-gray-50 text-gray-400';
                                            if(score === 5) bg = 'bg-green-100 text-green-600';
                                            else if(score >= 3) bg = 'bg-blue-100 text-blue-600';
                                            else if(score > 0) bg = 'bg-orange-100 text-orange-600';
                                            if (isSelected) bg = 'bg-indigo-600 text-white';

                                            return (
                                                <div key={d} className="relative w-10 h-10 flex items-center justify-center">
                                                    <HabitRing total={data.habits.length} completed={completedHabits} size={44} />
                                                    <div onClick={() => setSelectedDate(dDate)} className={`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold cursor-pointer absolute ${bg}`}>{d}</div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>
                                {/* Zaman √áizelgesi */}
                                <div>
                                    <h3 className="font-bold text-gray-500 mb-2 ml-1">BU G√úN√úM</h3>
                                    <div className="bg-white rounded-2xl shadow-sm border p-4 space-y-2">
                                        {Array.from({length: 18}, (_, i) => i + 6).map(h => {
                                            const tasksInHour = (currentDayData.tasks||[]).filter(t => t.startTime && parseInt(t.startTime.split(':')[0]) === h);
                                            return (
                                                <div key={h} className="flex gap-4 h-12 border-b border-gray-50 last:border-0">
                                                    <div className="w-10 text-xs text-gray-400 pt-2 text-right">{h.toString().padStart(2,'0')}:00</div>
                                                    <div className="flex-1 relative">
                                                        {tasksInHour.map(t => (<div key={t.id} className="absolute top-1 left-0 right-0 bottom-1 bg-indigo-50 border-l-4 border-indigo-500 rounded px-2 flex items-center text-xs font-bold text-indigo-700 shadow-sm">{t.title}</div>))}
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                    </div>

                    {/* BOTTOM NAV */}
                    <div className="bg-white border-t border-gray-100 flex justify-between items-end px-6 pb-6 pt-3 shrink-0">
                        <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center gap-1 ${activeTab === 'calendar' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icon name="calendar" size={24} />
                            <span className="text-[10px] font-bold tracking-wide">TAKVƒ∞M</span>
                        </button>

                        <button onClick={() => setActiveTab('projects')} className={`flex flex-col items-center gap-1 ${activeTab === 'projects' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icon name="briefcase" size={24} />
                            <span className="text-[10px] font-bold tracking-wide">HEDEF</span>
                        </button>

                        <div className="relative -top-5">
                            <button onClick={() => setActiveTab('planner')} className={`w-14 h-14 rounded-full flex items-center justify-center shadow-xl border-4 border-white transition-transform active:scale-95 ${activeTab === 'planner' ? 'bg-indigo-600 text-white' : 'bg-indigo-600 text-white'}`}>
                                <Icon name="plus" size={32} />
                            </button>
                        </div>

                        <button onClick={() => setActiveTab('habits')} className={`flex flex-col items-center gap-1 ${activeTab === 'habits' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Icon name="list" size={24} />
                            <span className="text-[10px] font-bold tracking-wide">RUTƒ∞NLER</span>
                        </button>

                        <button onClick={() => setActiveTab('store')} className={`flex flex-col items-center gap-1 ${activeTab === 'store' ? 'text-yellow-500' : 'text-gray-400'}`}>
                            <Icon name="shopping-bag" size={24} />
                            <span className="text-[10px] font-bold tracking-wide">MAƒûAZA</span>
                        </button>
                    </div>

                    {/* MODALS */}
                    {modal.open && (
                        <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-in">
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-slide-up">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-lg uppercase text-gray-800">{modal.type.replace('_', ' ')}</h3>
                                    <button onClick={() => setModal({open:false})}><Icon name="x" className="text-gray-400 hover:text-gray-600"/></button>
                                </div>

                                {modal.type === 'selection' && (
                                    <div className="space-y-3">
                                        <button onClick={() => {setForm({}); setModal({type:'simple'});}} className="w-full p-4 bg-indigo-50 text-indigo-600 rounded-xl font-bold text-left flex items-center gap-3 hover:bg-indigo-100 transition"><div class="bg-white p-2 rounded-full"><Icon name="plus" className="w-4 h-4"/></div> Tek Seferlik G√∂rev</button>
                                        <div className="text-xs font-bold text-gray-400 mt-4 ml-1">HEDEFLERDEN √áEK</div>
                                        <div className="max-h-48 overflow-y-auto space-y-2 no-scrollbar">
                                            {data.projects.map(p => (
                                                <button key={p.id} onClick={() => {setForm({amount:''}); setModal({type:'import', data:p});}} className="w-full p-3 border rounded-xl text-left text-sm font-bold hover:bg-gray-50 hover:border-indigo-300 transition flex justify-between"><span>{p.title}</span><span class="text-gray-400 text-xs">{p.unit}</span></button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {(modal.type === 'simple' || modal.type === 'import') && (
                                    <div className="space-y-4">
                                        {modal.type === 'import' && <h4 className="text-indigo-600 font-bold text-center text-lg">{modal.data.title}</h4>}
                                        {modal.type === 'simple' && <input className="w-full p-4 bg-gray-50 rounded-xl font-bold focus:ring-2 ring-indigo-200" placeholder="G√∂rev Adƒ±" autoFocus onChange={e=>setForm({...form, title:e.target.value})} />}
                                        {modal.type === 'import' && <div className="flex items-baseline justify-center gap-2"><input type="number" className="w-24 text-center text-4xl font-bold border-b-2 border-indigo-600 outline-none bg-transparent" placeholder="0" autoFocus onChange={e=>setForm({...form, amount:e.target.value})} /><span className="font-bold text-gray-400">{modal.data.unit}</span></div>}
                                        <div className="flex gap-3">
                                            <input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="S√ºre (dk)" value={form.time||''} onChange={e=>setForm({...form, time:e.target.value})} />
                                            <input className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Saat (14:00)" value={form.startTime||''} onChange={e=>setForm({...form, startTime:e.target.value})} />
                                        </div>
                                        <button onClick={addTask} className="w-full bg-indigo-600 text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition mt-2">EKLE</button>
                                    </div>
                                )}

                                {modal.type === 'project_form' && (
                                    <div className="space-y-3">
                                        <input className="w-full p-3 bg-gray-50 rounded-xl font-bold" placeholder="Proje Adƒ±" value={form.title||''} onChange={e=>setForm({...form, title:e.target.value})} />
                                        <div className="flex gap-2"><input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Toplam" value={form.total||''} onChange={e=>setForm({...form, total:e.target.value})} /><input className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Birim" value={form.unit||''} onChange={e=>setForm({...form, unit:e.target.value})} /></div>
                                        <div className="flex gap-2"><input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Ba≈ülangƒ±√ß" value={form.current||''} onChange={e=>setForm({...form, current:e.target.value})} /><input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Tahmini Saat" value={form.estTime||''} onChange={e=>setForm({...form, estTime:e.target.value})} /></div>
                                        <button onClick={saveProject} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold mt-2 shadow-lg">KAYDET</button>
                                    </div>
                                )}

                                {(modal.type === 'reward_new') && (
                                    <div className="space-y-3">
                                        <div className="flex gap-2"><input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="Bedel" value={form.cost||''} onChange={e=>setForm({...form, cost:e.target.value})} /><input className="w-16 p-3 bg-gray-50 rounded-xl text-center" placeholder="üéÅ" value={form.icon||''} onChange={e=>setForm({...form, icon:e.target.value})} /></div>
                                        <input className="w-full p-3 bg-gray-50 rounded-xl" placeholder="√ñd√ºl Adƒ±" value={form.title||''} onChange={e=>setForm({...form, title:e.target.value})} />
                                        <button onClick={addReward} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold mt-2 shadow-lg">EKLE</button>
                                    </div>
                                )}

                                {modal.type === 'journal' && (
                                    <div className="space-y-3">
                                        <div className="flex justify-around text-2xl bg-gray-50 p-3 rounded-xl">
                                            {['üò´','üòê','üôÇ','üòÉ','ü§©'].map(m => <button key={m} onClick={()=>setForm({...form, mood:m})} className={`p-2 rounded hover:bg-white transition ${form.mood===m?'bg-white shadow scale-125':''}`}>{m}</button>)}
                                        </div>
                                        <textarea className="w-full p-3 bg-gray-50 rounded-xl h-32 resize-none focus:ring-2 ring-indigo-200" placeholder="Bug√ºn nasƒ±l ge√ßti?" value={form.note||''} onChange={e=>setForm({...form, note:e.target.value})}></textarea>
                                        <button onClick={saveJournal} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg">KAYDET</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
